/*
 * waf
 * No description provided (generated by Swagger Codegen https://github.com/swagger-api/swagger-codegen)
 *
 * OpenAPI spec version: common-version
 *
 *
 * NOTE: This class is auto generated by the swagger code generator program.
 * https://github.com/swagger-api/swagger-codegen.git
 * Do not edit the class manually.
 */

package com.volcengine.wafruntime;


import com.volcengine.ApiClient;
import com.volcengine.ApiException;
import com.volcengine.ApiResponse;
import com.volcengine.waf.WafApi;
import com.volcengine.waf.model.CheckLLMResponseStreamRequest;
import com.volcengine.waf.model.CheckLLMResponseStreamResponse;

public class WafApiRuntime extends WafApi {
    private String Streambuf = "";
    private int StreamSendLen = 0;
    private String MsgID = "";
    private ApiClient apiClient;
    private CheckLLMResponseStreamResponse defaultBody;

    // WafApiRuntime 的构造函数，显式调用父类的构造函数
    public WafApiRuntime(ApiClient apiClient) {
        super(apiClient);  // 调用父类的带参数构造函数
        this.apiClient = apiClient;
    }

    // 提供一个方法用于更新拼接字符串和发送长度
    public void appendStreambuf(String value) {
        Streambuf = Streambuf + value;
        StreamSendLen += Streambuf.length();
    }

    @Override
    public CheckLLMResponseStreamResponse checkLLMResponseStream(CheckLLMResponseStreamRequest body) throws ApiException {
        appendStreambuf(body.getContent());
        // 发送长度小于10个字符并且不是第一次也不是最后一次的条件下则缓存content
        if (StreamSendLen < 10 && body.getMsgID() != null && body.getUseStream() != 2) {
            return defaultBody;
        }
        StreamSendLen = 0;
        body.setContent(Streambuf);
        if (!MsgID.isEmpty()) {
            body.setMsgID(MsgID);
        }


        if (!body.getContent().isEmpty()) {
            ApiResponse<CheckLLMResponseStreamResponse> resp = checkLLMResponseStreamWithHttpInfo(body);
            if (MsgID.isEmpty()) {
                MsgID = resp.getData().getMsgID();
            }
            defaultBody = resp.getData();
            return resp.getData();
        }
        return null;
    }
}
